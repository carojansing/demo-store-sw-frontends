{"version":3,"file":"html-to-ast.esm.js","sources":["../src/element.ts","../src/parse-tag.ts","../src/parse.ts","../src/stringify.ts"],"sourcesContent":["export const htmlVoidElements = [\n    'area',\n    'base',\n    'basefont',\n    'bgsound',\n    'br',\n    'col',\n    'command',\n    'embed',\n    'frame',\n    'hr',\n    'image',\n    'img',\n    'input',\n    'isindex',\n    'keygen',\n    'link',\n    'menuitem',\n    'meta',\n    'nextid',\n    'param',\n    'source',\n    'track',\n    'wbr'\n  ]","import { Comment, IDoc } from './types';\n\nimport { htmlVoidElements } from './element';\n\nconst attrRE = /\\s([^'\"/\\s><]+?)[\\s/>]|([^\\s=]+)=\\s?(\".*?\"|'.*?')/g;\n\nexport const parseTag = (tag: string): IDoc | Comment => {\n  const res: IDoc = {\n    type: 'tag',\n    name: '',\n    voidElement: false,\n    attrs: {},\n    children: [],\n  };\n\n  const tagMatch = tag.match(/<\\/?([^\\s]+?)[/\\s>]/);\n  if (tagMatch) {\n    res.name = tagMatch[1];\n    res.voidElement =\n      htmlVoidElements.includes(tagMatch[1]) ||\n      tag.charAt(tag.length - 2) === '/';\n\n    // handle comment tag\n    if (res.name.startsWith('!--')) {\n      const endIndex = tag.indexOf('-->');\n      return {\n        type: 'comment',\n        comment: endIndex !== -1 ? tag.slice(4, endIndex) : '',\n      };\n    }\n  }\n\n  const reg = new RegExp(attrRE);\n  let result = null;\n  for (;;) {\n    result = reg.exec(tag);\n\n    if (result === null) {\n      break;\n    }\n\n    if (!result[0].trim()) {\n      continue;\n    }\n\n    if (result[1]) {\n      const attr = result[1].trim();\n      let arr = [attr, ''];\n\n      if (attr.indexOf('=') > -1) {\n        arr = attr.split('=');\n      }\n\n      res.attrs[arr[0]] = arr[1];\n      reg.lastIndex--;\n    } else if (result[2]) {\n      res.attrs[result[2]] = result[3]\n        .trim()\n        .substring(1, result[3].length - 1);\n    }\n  }\n\n  return res;\n};\n","import type { Attr, IOptions } from './types';\n\nimport { parseTag } from './parse-tag';\n\nconst tagRE = /<[a-zA-Z0-9\\-\\!\\/](?:\"[^\"]*\"|'[^']*'|[^'\">])*>/g;\nconst whitespaceRE = /^\\s*$/;\n\n// re-used obj for quick lookups of components\nconst empty = Object.create(null);\n\ninterface MaybeDoc {\n  type?: string;\n  text?: string;\n  content?: string;\n  voidElement?: boolean;\n  name?: string;\n  style?: string[];\n  attrs?: Attr;\n  children?: MaybeDoc[];\n  comment?: string;\n}\n\nexport const parse = (html: string, options: Partial<IOptions> = {}) => {\n  options || (options = {});\n  options.components || (options.components = empty);\n  const result: MaybeDoc[] = [];\n  const arr: MaybeDoc[] = [];\n  let current: MaybeDoc;\n  let level = -1;\n  let inComponent = false;\n\n  // handle text at top level\n  if (html.indexOf('<') !== 0) {\n    var end = html.indexOf('<');\n    result.push({\n      type: 'text',\n      content: end === -1 ? html : html.substring(0, end),\n    });\n  }\n  // @ts-ignore\n  html.replace(tagRE, function (tag, index) {\n    if (inComponent) {\n      if (tag !== '</' + current.name + '>') {\n        return '';\n      } else {\n        inComponent = false;\n      }\n    }\n    const isOpen = tag.charAt(1) !== '/';\n    const isComment = tag.startsWith('<!--');\n    const start = index + tag.length;\n    const nextChar = html.charAt(start);\n\n    let parent: MaybeDoc | MaybeDoc['children'];\n\n    if (isComment) {\n      const comment = parseTag(tag);\n\n      // if we're at root, push new base node\n      if (level < 0) {\n        result.push(comment);\n        return result\n      }\n      parent = arr[level];\n      if (parent && parent.children && Array.isArray(parent.children)) {\n        parent.children.push(comment);\n      }\n      return result\n    }\n\n    if (isOpen) {\n      level++;\n\n      current = parseTag(tag);\n      if (\n        current.type === 'tag' &&\n        current.name &&\n        options.components &&\n        options.components[current.name]\n      ) {\n        current.type = 'component';\n        inComponent = true;\n      }\n\n      if (\n        !current.voidElement &&\n        !inComponent &&\n        nextChar &&\n        nextChar !== '<' &&\n        Array.isArray(current.children)\n      ) {\n        current.children.push({\n          type: 'text',\n          content: html.slice(start, html.indexOf('<', start)),\n        });\n      }\n\n      // if we're at root, push new base node\n      if (level === 0) {\n        result.push(current);\n      }\n\n      parent = arr[level - 1];\n\n      if (parent && parent.children) {\n        parent.children.push(current);\n      }\n\n      arr[level] = current;\n    }\n\n    if (!isOpen || current.voidElement) {\n      if (\n        level > -1 &&\n        (current.voidElement || current.name === tag.slice(2, -1))\n      ) {\n        level--;\n        // move current up a level to match the end tag\n        current = level === -1 ? (result as MaybeDoc) : arr[level];\n      }\n      if (!inComponent && nextChar !== '<' && nextChar) {\n        // trailing text node\n        // if we're at the root, push a base text node. otherwise add as\n        // a child to the current node.\n        parent = level === -1 ? result : (arr[level].children as MaybeDoc[]);\n\n        // calculate correct end of the content slice in case there's\n        // no tag after the text node.\n        const end = html.indexOf('<', start);\n        let content = html.slice(start, end === -1 ? undefined : end);\n        // if a node is nothing but whitespace, collapse it as the spec states:\n        // https://www.w3.org/TR/html4/struct/text.html#h-9.1\n        if (whitespaceRE.test(content)) {\n          content = ' ';\n        }\n        // don't add whitespace-only text nodes if they would be trailing text nodes\n        // or if they would be leading whitespace-only text nodes:\n        //  * end > -1 indicates this is not a trailing text node\n        //  * leading node is when level is -1 and parent has length 0\n        if ((end > -1 && level + parent.length >= 0) || content !== ' ') {\n          if (parent && Array.isArray(parent)) {\n            parent.push({\n              type: 'text',\n              content: content,\n            });\n          }\n        }\n      }\n    }\n  });\n\n  return result;\n};\n","import { Attr, IDoc } from './types';\n\nfunction attrString(attrs: Attr) {\n  const buff = [];\n  for (let key in attrs) {\n    buff.push(key + '=\"' + attrs[key] + '\"');\n  }\n  if (!buff.length) {\n    return '';\n  }\n  return ' ' + buff.join(' ');\n}\n\nfunction _stringify(buff: string, doc: IDoc): string {\n  switch (doc.type) {\n    case 'text':\n      return buff + doc.content;\n    case 'tag':\n      buff +=\n        '<' +\n        doc.name +\n        (doc.attrs ? attrString(doc.attrs) : '') +\n        (doc.voidElement ? '/>' : '>');\n      if (doc.voidElement) {\n        return buff;\n      }\n      return buff + doc.children.reduce(_stringify, '') + '</' + doc.name + '>';\n    case 'comment':\n      buff += '<!--' + doc.comment + '-->';\n      return buff;\n    default:\n      return '';\n  }\n}\n\nexport const stringify = (doc: IDoc[]) => {\n  return doc.reduce(function (token: string, rootEl: IDoc) {\n    return token + _stringify('', rootEl);\n  }, '');\n};\n"],"names":["htmlVoidElements","attrRE","parseTag","tag","res","type","name","voidElement","attrs","children","tagMatch","match","includes","charAt","length","startsWith","endIndex","indexOf","comment","slice","reg","RegExp","result","exec","trim","attr","arr","split","lastIndex","substring","tagRE","whitespaceRE","empty","Object","create","parse","html","options","components","current","level","inComponent","end","push","content","replace","index","isOpen","isComment","start","nextChar","parent","Array","isArray","undefined","test","attrString","buff","key","join","_stringify","doc","reduce","stringify","token","rootEl"],"mappings":"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"}